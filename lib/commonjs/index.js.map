{"version":3,"names":["LINKING_ERROR","Platform","select","ios","default","CashfreePgApi","NativeModules","Proxy","get","Error","CFPaymentGateway","constructor","emitter","OS","NativeEventEmitter","CashfreeEventEmitter","NativeAppEventEmitter","doPayment","checkoutPayment","version","JSON","stringify","setCallback","cfCallback","successFunction","orderID","console","log","onVerify","failureFunction","error","response","CFErrorResponse","message","parse","fromJSON","onError","successSubscription","addListener","failureSubscription","removeCallback","undefined","removeSubscription","errorString","object","status","code","type","getStatus","getMessage","getCode","getType","CFPaymentGatewayService"],"sources":["index.tsx"],"sourcesContent":["import {\n  EmitterSubscription,\n  EventEmitter,\n  NativeAppEventEmitter,\n  NativeEventEmitter,\n  NativeModules,\n  Platform,\n} from 'react-native';\nimport { version } from '../package.json';\nimport type { CheckoutPayment } from 'cashfree-pg-api-contract';\n\nconst LINKING_ERROR =\n  `The package 'react-native-cashfree-pg-api' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst CashfreePgApi = NativeModules.CashfreePgApi\n  ? NativeModules.CashfreePgApi\n  : new Proxy(\n      {},\n      {\n        get() {\n          throw new Error(LINKING_ERROR);\n        },\n      }\n    );\n\nclass CFPaymentGateway {\n  private emitter: EventEmitter;\n  private successSubscription: EmitterSubscription | null = null;\n  private failureSubscription: EmitterSubscription | null = null;\n\n  constructor() {\n    this.emitter =\n      Platform.OS === 'ios'\n        ? new NativeEventEmitter(NativeModules.CashfreeEventEmitter)\n        : NativeAppEventEmitter;\n  }\n\n  doPayment(checkoutPayment: CheckoutPayment) {\n    checkoutPayment.version = version;\n    CashfreePgApi.doPayment(JSON.stringify(checkoutPayment));\n  }\n\n  setCallback(cfCallback: CFCallback) {\n    // this.cfCallback = cfCallback;\n    let successFunction = (orderID: string) => {\n      console.log('response is : ' + JSON.stringify(orderID));\n      cfCallback.onVerify(orderID);\n    };\n    let failureFunction = (error: string) => {\n      console.log('reason: ' + JSON.stringify(error));\n      const response = new CFErrorResponse();\n      // @ts-ignore\n      const message = JSON.parse(error);\n      response.fromJSON(message.error);\n      // @ts-ignore\n      cfCallback.onError(response, message.orderID);\n    };\n    this.successSubscription = this.emitter.addListener(\n      'cfSuccess',\n      successFunction\n    );\n    this.failureSubscription = this.emitter.addListener(\n      'cfFailure',\n      failureFunction\n    );\n    CashfreePgApi.setCallback();\n  }\n\n  removeCallback() {\n    if (\n      this.successSubscription !== undefined &&\n      this.successSubscription !== null\n    ) {\n      this.emitter.removeSubscription(this.successSubscription);\n      this.successSubscription = null;\n    }\n    if (\n      this.failureSubscription !== undefined &&\n      this.failureSubscription !== null\n    ) {\n      this.emitter.removeSubscription(this.failureSubscription);\n      this.failureSubscription = null;\n    }\n  }\n}\n\nexport interface CFCallback {\n  onVerify(orderID: string): void;\n\n  onError(error: CFErrorResponse, orderID: string): void;\n}\n\nexport class CFErrorResponse {\n  private status: string = 'FAILED';\n  private message: string = 'payment has failed';\n  private code: string = 'payment_failed';\n  private type: string = 'request_failed';\n\n  fromJSON(errorString: string) {\n    console.log('errorString :' + errorString);\n    const object = JSON.parse(errorString);\n    console.log('errorStringObject :' + object);\n    this.status = object.status;\n    this.message = object.message;\n    this.code = object.code;\n    this.type = object.type;\n  }\n\n  getStatus(): string {\n    return this.status;\n  }\n\n  getMessage(): string {\n    return this.message;\n  }\n\n  getCode(): string {\n    return this.code;\n  }\n\n  getType(): string {\n    return this.type;\n  }\n}\n\nexport var CFPaymentGatewayService = new CFPaymentGateway();\n"],"mappings":"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"}